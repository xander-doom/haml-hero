{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "HAML",
	"scopeName": "text.haml",
	"fileTypes": ["haml"],
	"patterns": [
		{
			"include": "#escaped-line"
		},
		{
			"include": "#haml-comment"
		},
		{
			"include": "#html-comment"
		},
		{
			"include": "#doctype"
		},
		{
			"include": "#filter"
		},
		{
			"include": "#ruby-control-flow"
		},
		{
			"include": "#script"
		},
		{
			"include": "#element"
		},
		{
			"include": "#plain-text"
		}
	],
	"repository": {
		"escaped-line": {
			"comment": "Backslash escapes the first character, treating line as plain text",
			"name": "string.unquoted.haml",
			"match": "^(\\s*)(\\\\)(.*)$",
			"captures": {
				"2": {
					"name": "constant.character.escape.haml"
				}
			}
		},
		"haml-comment": {
			"name": "comment.line.haml",
			"begin": "^(\\s*)(-#)",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"1": {
					"name": "punctuation.whitespace.comment.leading.haml"
				},
				"2": {
					"name": "punctuation.definition.comment.haml"
				}
			}
		},
		"html-comment": {
			"patterns": [
				{
					"comment": "Conditional comment /[if IE]",
					"name": "comment.block.html.conditional.haml",
					"begin": "^(\\s*)(\\/!?\\[)",
					"end": "^(?!\\1\\s+|$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.whitespace.comment.leading.haml"
						},
						"2": {
							"name": "punctuation.definition.comment.haml"
						}
					}
				},
				{
					"comment": "Multi-line HTML comment (/ or //)",
					"name": "comment.block.html.haml",
					"begin": "^(\\s*)(\\/\\/?)(\\s*)$",
					"end": "^(?!\\1\\s+|$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.whitespace.comment.leading.haml"
						},
						"2": {
							"name": "punctuation.definition.comment.haml"
						}
					}
				},
				{
					"comment": "Single-line HTML comment (/ or //)",
					"name": "comment.block.html.haml",
					"match": "^(\\s*)(\\/\\/?)(\\s+.*)$",
					"captures": {
						"1": {
							"name": "punctuation.whitespace.comment.leading.haml"
						},
						"2": {
							"name": "punctuation.definition.comment.haml"
						}
					}
				}
			]
		},
		"doctype": {
			"name": "meta.prolog.haml",
			"match": "^(\\s*)(!!!)\\s*(.*)$",
			"captures": {
				"1": {
					"name": "punctuation.whitespace.doctype.leading.haml"
				},
				"2": {
					"name": "keyword.other.doctype.haml"
				},
				"3": {
					"name": "string.unquoted.doctype.haml"
				}
			}
		},
		"filter": {
			"patterns": [
				{
					"include": "#filter-javascript"
				},
				{
					"include": "#filter-coffee"
				},
				{
					"include": "#filter-css"
				},
				{
					"include": "#filter-scss"
				},
				{
					"include": "#filter-ruby"
				},
				{
					"include": "#filter-erb"
				},
				{
					"include": "#filter-markdown"
				},
				{
					"include": "#filter-plain"
				}
			]
		},
		"filter-javascript": {
			"begin": "^(\\s*)(:javascript)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "source.js"
				}
			]
		},
		"filter-coffee": {
			"begin": "^(\\s*)(:coffee|:coffeescript)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "source.coffee"
				}
			]
		},
		"filter-css": {
			"begin": "^(\\s*)(:css)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "source.css"
				}
			]
		},
		"filter-erb": {
			"begin": "^(\\s*)(:erb)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "text.html.erb"
				}
			]
		},
		"filter-ruby": {
			"begin": "^(\\s*)(:ruby)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "source.ruby"
				}
			]
		},
		"filter-markdown": {
			"begin": "^(\\s*)(:markdown|:md)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "text.html.markdown"
				}
			]
		},
		"filter-scss": {
			"begin": "^(\\s*)(:scss|:sass)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"include": "source.css.scss"
				}
			]
		},
		"filter-plain": {
			"begin": "^(\\s*)(:plain|:escaped|:preserve|:cdata)\\s*$",
			"end": "^(?!\\1\\s+|$)",
			"beginCaptures": {
				"2": {
					"name": "entity.name.namespace.haml"
				}
			},
			"patterns": [
				{
					"name": "text.plain.haml",
					"match": ".+"
				}
			]
		},
		"script": {
			"begin": "^(\\s*)([!&]?=|~|-)\\s*",
			"end": "^(?!\\1\\s)",
			"beginCaptures": {
				"1": {
					"name": "punctuation.whitespace.script.leading.haml"
				},
				"2": {
					"name": "punctuation.definition.script.haml"
				}
			},
			"patterns": [
				{
					"include": "#ruby-block-with-haml"
				},
				{
					"include": "source.ruby"
				}
			]
		},
		"element": {
			"patterns": [
				{
					"name": "meta.tag.haml",
					"begin": "^(\\s*)(%)([-\\w:-]+)",
					"end": "$",
					"beginCaptures": {
						"1": {
							"name": "punctuation.whitespace.tag.leading.haml"
						},
						"2": {
							"name": "punctuation.definition.tag.haml"
						},
						"3": {
							"name": "entity.name.tag.haml"
						}
					},
					"patterns": [
						{
							"include": "#element-attributes"
						},
						{
							"include": "#element-content"
						}
					]
				},
				{
					"name": "meta.tag.haml",
					"begin": "^(\\s*)(?=[.#])",
					"end": "$",
					"beginCaptures": {
						"1": {
							"name": "punctuation.whitespace.tag.leading.haml"
						}
					},
					"patterns": [
						{
							"include": "#element-attributes"
						},
						{
							"include": "#element-content"
						}
					]
				}
			]
		},
		"element-attributes": {
			"patterns": [
				{
					"include": "#element-attributes-html"
				},
				{
					"include": "#element-attributes-ruby"
				},
				{
					"match": "\\.[\\w-]+",
					"name": "entity.name.tag.haml"
				},
				{
					"match": "#[\\w-]+",
					"name": "entity.other.attribute-name.id.haml"
				},
				{
					"comment": "Object reference [@user]",
					"begin": "\\[",
					"end": "\\]",
					"beginCaptures": {
						"0": {
							"name": "punctuation.section.object-reference.begin.haml"
						}
					},
					"endCaptures": {
						"0": {
							"name": "punctuation.section.object-reference.end.haml"
						}
					},
					"patterns": [
						{
							"include": "source.ruby"
						}
					]
				},
				{
					"comment": "Void tag marker, whitespace modifiers",
					"match": "[/<>]+",
					"name": "punctuation.definition.tag.haml"
				},
				{
					"include": "#element-modifiers"
				}
			]
		},
		"element-attributes-ruby": {
			"name": "meta.section.attributes.haml",
			"begin": "(?<!#)\\{",
			"end": "\\}",
			"beginCaptures": {
				"0": {
					"name": "punctuation.section.scope.begin.haml"
				}
			},
			"endCaptures": {
				"0": {
					"name": "punctuation.section.scope.end.haml"
				}
			},
			"patterns": [
				{
					"include": "#element-attributes-ruby"
				},
				{
					"include": "source.ruby"
				}
			]
		},
		"element-attributes-html": {
			"name": "meta.section.attributes.html.haml",
			"begin": "\\(",
			"end": "\\)",
			"beginCaptures": {
				"0": {
					"name": "punctuation.section.scope.begin.haml"
				}
			},
			"endCaptures": {
				"0": {
					"name": "punctuation.section.scope.end.haml"
				}
			},
			"patterns": [
				{
					"match": "([\\w:-]+)\\s*(=)\\s*",
					"captures": {
						"1": {
							"name": "entity.other.attribute-name.html.haml"
						},
						"2": {
							"name": "punctuation.separator.key-value.haml"
						}
					}
				},
				{
					"include": "source.ruby"
				}
			]
		},
		"element-modifiers": {
			"match": "[<>~/]",
			"name": "punctuation.definition.tag.modifier.haml"
		},
		"element-content": {
			"patterns": [
				{
					"name": "meta.line.ruby.haml",
					"begin": "(=)(=)?([<>~])?\\s+",
					"end": "(?=$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.script.output.haml"
						},
						"2": {
							"name": "punctuation.definition.script.output.preserve.haml"
						},
						"3": {
							"name": "punctuation.definition.script.whitespace.haml"
						}
					},
					"patterns": [
						{
							"include": "source.ruby"
						}
					]
				},
				{
					"begin": "\\s+",
					"end": "(?=$)",
					"name": "text.haml",
					"patterns": [
						{
							"include": "#interpolation"
						}
					]
				}
			]
		},
		"interpolation": {
			"name": "meta.interpolation.ruby.haml",
			"begin": "#\\{",
			"end": "\\}",
			"beginCaptures": {
				"0": {
					"name": "punctuation.section.embedded.begin.ruby"
				}
			},
			"endCaptures": {
				"0": {
					"name": "punctuation.section.embedded.end.ruby"
				}
			},
			"patterns": [
				{
					"include": "source.ruby"
				}
			]
		},
		"plain-text": {
			"begin": "^\\s+(?![%\\-=~!&#\\/.])",
			"end": "$",
			"name": "text.haml",
			"patterns": [
				{
					"include": "#interpolation"
				}
			]
		},
		"ruby-control-flow": {
			"patterns": [
				{
					"begin": "^(\\s*)(-)\\s+(if|unless|elsif|case|when|while|until|for|begin)\\b",
					"beginCaptures": {
						"2": {
							"name": "punctuation.definition.script.haml"
						},
						"3": {
							"name": "keyword.control.ruby"
						}
					},
					"end": "^(?!\\1\\s)",
					"patterns": [
						{
							"begin": "\\G",
							"end": "$",
							"patterns": [
								{
									"include": "source.ruby"
								}
							]
						},
						{
							"include": "$self"
						}
					]
				},
				{
					"begin": "^(\\s*)(-)\\s+(else)\\s*$",
					"beginCaptures": {
						"2": {
							"name": "punctuation.definition.script.haml"
						},
						"3": {
							"name": "keyword.control.ruby"
						}
					},
					"end": "^(?!\\1\\s)",
					"patterns": [
						{
							"include": "$self"
						}
					]
				},
				{
					"begin": "^(\\s*)(-)\\s+(.*?)(?=\\bdo\\b)",
					"beginCaptures": {
						"2": {
							"name": "punctuation.definition.script.haml"
						},
						"3": {
							"patterns": [
								{
									"include": "source.ruby"
								}
							]
						}
					},
					"end": "^(?!\\1\\s)",
					"patterns": [
						{
							"begin": "\\G",
							"end": "$",
							"patterns": [
								{
									"match": "\\bdo\\b",
									"name": "keyword.control.ruby"
								},
								{
									"include": "source.ruby"
								}
							]
						},
						{
							"include": "$self"
						}
					]
				}
			]
		},
		"ruby-block-with-haml": {
			"begin": "\\bdo\\b",
			"end": "^(?=\\S)",
			"beginCaptures": {
				"0": {
					"name": "keyword.control.ruby"
				}
			},
			"patterns": [
				{
					"begin": "\\G(?=\\s*\\S)",
					"end": "$",
					"patterns": [
						{
							"include": "source.ruby"
						}
					]
				},
				{
					"include": "$self"
				}
			]
		}
	}
}